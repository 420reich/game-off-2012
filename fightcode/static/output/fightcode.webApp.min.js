/*! FightCode - v0.1.0
* http://fightcodega.me/
*/

var Ranking, container, ranking;

container = $(".ranking-container");

Ranking = (function() {

  function Ranking(container) {
    this.container = container;
    this.bindEvents();
  }

  Ranking.prototype.bindEvents = function() {
    var links;
    links = this.container.find('.actions a');
    return links.bind('click', function(ev) {
      var link, opponentId;
      link = $(ev.currentTarget);
      opponentId = link.attr('data-robot-id');
      return window.location = '/heynemann/robots/MYROBOT/fight/' + opponentId;
    });
  };

  return Ranking;

})();

if (container.length > 0) {
  ranking = new Ranking(container);
}

var FightArena, arena, container;

container = $(".fight-arena");

FightArena = (function() {

  function FightArena(container) {
    this.container = container;
    this.defaultCode = "            window.robotClass = function(){            };            window.robotClass.prototype.onIdle = function(ev) {               var robot = ev.robot;                              robot.rotateCannon(180);               robot.ahead(100);               robot.turn(45);            };            window.robotClass.prototype.onScannedRobot = function(ev) {               var robot = ev.robot,                   scannedRobot = ev.scannedRobot;               if (robot.id == scannedRobot.parentId || robot.parentId == scannedRobot.id) {                   return;               }               robot.fire();            };            window.robotClass.prototype.onHitByBullet = function(ev) {               var robot = ev.robot;                              if (robot.availableClones > 0) {                   robot.clone();               }            };";
    this.wallCode = "            window.rotated = false;            window.robotClass = function(){            };            window.robotClass.prototype.onIdle = function(ev) {               var robot = ev.robot;               robot.ahead(1);               if (!window.rotated) {                   robot.rotateCannon(90);                   window.rotated = true;               }            };            window.robotClass.prototype.onWallCollision = function(ev) {               var robot = ev.robot;               robot.back(10);               robot.turn(90);            };            window.robotClass.prototype.onScannedRobot = function(ev) {               var robot = ev.robot;               robot.fire();            };";
    this.startWorker();
  }

  FightArena.prototype.startWorker = function() {
    var eventData, worker;
    worker = new Worker('/output/fightcode.worker.min.js');
    worker.onmessage = this.receiveWorkerEvent;
    eventData = {
      robots: 2,
      robot1: this.defaultCode,
      robot2: this.defaultCode
    };
    return worker.postMessage(eventData);
  };

  FightArena.prototype.receiveWorkerEvent = function(ev) {
    var board, boardContainer, evData, loading;
    evData = ev.data;
    if (evData.type === 'log') {
      console.log("LOG", evData.message);
    }
    if (evData.type === 'results') {
      board = container.find('.board');
      board.empty();
      boardContainer = $('<div></div>');
      board.append(boardContainer);
      loading = container.find('.loading');
      loading.addClass('animate');
      return setTimeout(function() {
        var game;
        loading.detach();
        game = new Game(boardContainer, evData.result, {
          msPerRound: 5
        });
        return game.initialize();
      }, 700);
    }
  };

  return FightArena;

})();

if (container.length > 0) {
  arena = new FightArena(container);
}

(function(){

  var menuContainer = $('.menu-container');
  var topBorder = $('.ribbon-container');
  var ribbon = menuContainer.find('.ribbon');

  ribbon.on('click', function(ev){
    ev.preventDefault();
    menuContainer.toggleClass('open');
  });

  ribbon.on('hover', function(){
    topBorder.trigger('hover');
  });

})();

(function() {
  var currentPathname, navbar;
  currentPathname = location.pathname;
  navbar = $('.menu-container');
  navbar.find('.checked').removeClass('checked');
  return navbar.find("a[href='" + currentPathname + "'], a[data-navbar-href='" + currentPathname + "']").addClass('checked');
})();


$(function() {
  return $(".dial").knob();
});
