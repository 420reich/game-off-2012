/*! FightCode - v0.1.0
* http://fightcodega.me/
*/

var elements;

elements = $(".top10 li");

elements.on('hover', function(ev) {
  elements.removeClass('open');
  return $(this).addClass('open');
});

var FightArena, arena, container;

container = $(".fight-arena");

FightArena = (function() {

  function FightArena(container) {
    this.container = container;
    this.defaultCode = "var Robot = function(){\n};\nRobot.prototype.onIdle = function(ev) {\n   var robot = ev.robot;\n   \n   robot.rotateCannon(180);\n   robot.ahead(100);\n   robot.turn(45);\n};\nRobot.prototype.onScannedRobot = function(ev) {\n   var robot = ev.robot,\n       scannedRobot = ev.scannedRobot;\n\n   if (robot.id == scannedRobot.parentId || robot.parentId == scannedRobot.id) {\n       return;\n   }\n   robot.fire();\n};\nRobot.prototype.onHitByBullet = function(ev) {\n   var robot = ev.robot;\n   \n   if (robot.availableClones > 0) {\n       robot.clone();\n   }\n};";
    this.rotateCode = "var Robot = function(robot){\n  # robot.turn(-robot.angle)\n  # robot.turnGunRight(360)\n  # robot.ahead(200)\n  # robot.turn(90)\n  # robot.ahead(200)\n  # robot.turn(90)\n  # robot.ahead(200)\n  # robot.turn(90)\n  # robot.ahead(200)\n};\nRobot.prototype.onIdle = function(ev) {\n   var robot = ev.robot;\n   # robot.turn(1);\n   # robot.fire();\n   # robot.ahead(1)\n   robot.turnGunRight(360)\n};\nRobot.prototype.onWallCollision = function(ev) {\n};\nRobot.prototype.onScannedRobot = function(ev) {\n  ev.robot.fire()\n};\nRobot.prototype.onHitByBullet = function(ev) {\n};";
    this.wallCode = "var Robot = function(robot) {\n  this.moveAmount = Math.max(robot.arenaWidth, robot.arenaHeight);\n\n  robot.turnLeft(robot.angle % 90);\n  robot.turnGunRight(90);\n};\nRobot.prototype.onIdle = function(ev) {\n  var robot = ev.robot;\n  # robot.back(1);\n};\nRobot.prototype.onWallCollision = function(ev) {\n  var robot = ev.robot;\n  robot.turnRight(90);\n};\nRobot.prototype.onHitByBullet = function(ev) {\n  global.log(ev.bearing)\n};\nRobot.prototype.onRobotCollision = function(ev) {\n  var robot = ev.robot;\n  global.log(ev.bearing)\n  if (ev.bearing > -90 && ev.bearing < 90) {\n    robot.back(100);\n  } else {\n    robot.ahead(100);\n  }\n};\nRobot.prototype.onScannedRobot = function(ev) {\n   var robot = ev.robot;\n   robot.fire();\n};";
    this.startWorker();
  }

  FightArena.prototype.startWorker = function() {
    var eventData, worker;
    worker = new Worker('/output/fightcode.worker.min.js');
    worker.onmessage = this.receiveWorkerEvent;
    eventData = {
      robots: 2,
      robot1: {
        name: "robot1",
        code: this.rotateCode,
        rectangle: {
          position: {
            x: 280,
            y: 200
          },
          angle: 0
        }
      },
      robot2: {
        name: "robot2",
        code: this.wallCode,
        rectangle: {
          position: {
            x: 250,
            y: 250
          },
          angle: -90
        }
      }
    };
    return worker.postMessage(eventData);
  };

  FightArena.prototype.receiveWorkerEvent = function(ev) {
    var board, boardContainer, evData, loading;
    evData = ev.data;
    if (evData.type === 'log') {
      console.log("LOG", evData.message);
    }
    if (evData.type === 'results') {
      board = container.find('.board');
      board.empty();
      boardContainer = $('<div></div>');
      board.append(boardContainer);
      loading = container.find('.loading');
      loading.addClass('animate');
      return setTimeout(function() {
        var game;
        loading.detach();
        game = new Game(boardContainer, evData, {
          msPerRound: 5,
          onEndGame: function(result) {
            return console.log(result.winner.robot.name);
          }
        });
        return game.initialize();
      }, 700);
    }
  };

  return FightArena;

})();

if (container.length > 0) {
  arena = new FightArena(container);
}

(function(){

  var menuContainer = $('.menu-container');
  var topBorder = $('.ribbon-container');
  var ribbon = menuContainer.find('.ribbon');

  ribbon.on('click', function(ev){
    ev.preventDefault();
    menuContainer.toggleClass('open');
  });

  ribbon.on('hover', function(){
    topBorder.trigger('hover');
  });

})();

(function() {
  var currentPathname, navbar;
  currentPathname = location.pathname;
  navbar = $('.menu-container');
  navbar.find('.checked').removeClass('checked');
  return navbar.find("a[href='" + currentPathname + "'], a[data-navbar-href='" + currentPathname + "']").addClass('checked');
})();

var UserChart,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

$(function() {
  return $(".dial").knob();
});

UserChart = (function() {

  function UserChart(element, data, width, height, bgcolor, colors) {
    this.element = element;
    this.data = data;
    this.width = width;
    this.height = height;
    this.bgcolor = bgcolor;
    this.colors = colors != null ? colors : ["#ed0027"];
    this.draw = __bind(this.draw, this);

    google.load("visualization", "1", {
      packages: ["corechart"]
    });
    google.setOnLoadCallback(this.draw);
  }

  UserChart.prototype.draw = function() {
    var dataTable, options;
    dataTable = google.visualization.arrayToDataTable(this.data);
    options = {
      curveType: "function",
      width: this.width,
      height: this.height,
      lineWidth: 7,
      enableInteractivity: false,
      chartArea: {
        left: 0,
        top: 0,
        width: "100%",
        height: "100%"
      },
      backgroundColor: this.bgcolor,
      colors: this.colors,
      fontSize: 0,
      vAxis: {
        baselineColor: this.bgcolor,
        gridlines: {
          color: this.bgcolor
        },
        textStyle: {
          color: this.bgcolor
        }
      },
      hAxis: {
        baselineColor: this.bgcolor,
        gridlines: {
          color: this.bgcolor
        },
        textStyle: {
          color: this.bgcolor
        }
      }
    };
    return new google.visualization.LineChart(this.element).draw(dataTable, options);
  };

  return UserChart;

})();

$('.user-chart').each(function() {
  var data, text;
  text = $(this).attr('data-chart-values');
  text = text.replace(/[']/gi, "\"");
  text = text.replace(/^\s*/gi, '').replace(/\s*$/gi, '');
  data = JSON.parse(text);
  return new UserChart(this, data, 252, 103, "#f7f7f7");
});
