/*! FightCode - v0.1.0
* http://fightcodega.me/
*/
var Game,__bind=function(e,t){return function(){return e.apply(t,arguments)}};(function(){var e,t,n,r,i,s;n=window,s=["ms","moz","webkit","o"];for(r=0,i=s.length;r<i;r++){t=s[r];if(n.requestAnimationFrame)break;n.requestAnimationFrame=n[""+t+"RequestAnimationFrame"],n.cancelAnimationFrame=n[""+t+"CancelAnimationFrame"]||n[""+t+"CancelRequestAnimationFrame"]}return e=0,n.requestAnimationFrame||(n.requestAnimationFrame=function(t){var r;return e=Math.max(e+16,r=+(new Date)),n.setTimeout(function(){return t(+(new Date))},e-r)}),n.cancelAnimationFrame||(n.cancelAnimationFrame=function(e){return clearTimeout(e)})})(),Game=function(){function e(e,t,n){this.board=e,this.result=t,this.options=n,this.play=__bind(this.play,this),this.events=t.result,this.currentRound=0,this.objects={},this.options=$.extend({msPerRound:100},this.options)}return e.prototype.initialize=function(){return this.lastRound=window.mozAnimationStartTime||Date.now(),requestAnimationFrame(this.play)},e.prototype.createTank=function(e){var t,n;return t=$('<div class="tank"><div class="body"></div><div class="cannon"></div><div class="life"></div><div class="explosion"></div></div>'),n={id:e.id,tank:t,body:t.find(".body"),cannon:t.find(".cannon"),life:t.find(".life")},this.board.append(t),this.objects[e.id]=n,n},e.prototype.createBullet=function(e){var t,n;return t=$('<div class="bullet"><div class="explosion"></div></div>'),this.board.append(t),n={id:e.id,bullet:t,width:t.width(),height:t.height()},this.objects[e.id]=n,n},e.prototype.applyRotate=function(e,t){return e.style.webkitTransform=e.style.mozTransform=e.style.transform="rotate3d(0,0,1,"+t+"deg)"},e.prototype.handleTank=function(e){var t;return t=this.objects[e.id]||this.createTank(e),t.tank[0].style.top=e.position.y-e.dimension.height/2+"px",t.tank[0].style.left=e.position.x-e.dimension.width/2+"px",t.life[0].style.width=30*e.life/100+"px",this.applyRotate(t.body[0],e.angle),this.applyRotate(t.cannon[0],e.angle+e.cannonAngle)},e.prototype.handleBullet=function(e){var t;return t=this.objects[e.id],t.bullet[0].style.top=e.position.y-t.height/2+"px",t.bullet[0].style.left=e.position.x-t.width/2+"px",this.applyRotate(t.bullet[0],e.angle)},e.prototype.removeBullet=function(e){return delete this.objects[e.id],e.bullet.remove()},e.prototype.play=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;i=e-this.lastRound,a=Math.floor(i/this.options.msPerRound),this.lastRound=window.mozAnimationStartTime||Date.now(),r=this.options.onRound;for(u=f=0;0<=a?f<=a:f>=a;u=0<=a?++f:--f){if(u+this.currentRound>=this.events.length)break;s=this.events[u+this.currentRound],r&&r(s),d=s.objects;for(l=0,h=d.length;l<h;l++){n=d[l];switch(n.type){case"tank":this.handleTank(n);break;case"bullet":this.objects[n.id]||this.createBullet(n),this.handleBullet(n)}}v=s.events;for(c=0,p=v.length;c<p;c++){o=v[c],n=this.objects[o.id];if(!n)continue;switch(o.type){case"moving":n.tank[0].className="tank moving";break;case"backwards":n.tank[0].className="tank moving backwards";break;case"stopped":n.tank[0].className="tank";break;case"cloned":n.tank[0].className="tank cloning";break;case"exploded":n.bullet[0].className="bullet exploding",setTimeout(this.removeBullet.bind(this,n),1e3);break;case"dead":n.tank[0].className="tank dead"}}}t=a+this.currentRound>=this.events.length,t&&this.options.onEndGame&&this.options.onEndGame(this.result),this.currentRound+=a;if(!t)return requestAnimationFrame(this.play)},e}();