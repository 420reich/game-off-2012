/*! FightCode - v0.1.0
* http://fightcodega.me/
*/
var Game,__bind=function(e,t){return function(){return e.apply(t,arguments)}};(function(){var e,t,n,r,i,s;n=window,s=["ms","moz","webkit","o"];for(r=0,i=s.length;r<i;r++){t=s[r];if(n.requestAnimationFrame)break;n.requestAnimationFrame=n[""+t+"RequestAnimationFrame"],n.cancelAnimationFrame=n[""+t+"CancelAnimationFrame"]||n[""+t+"CancelRequestAnimationFrame"]}return e=0,n.requestAnimationFrame||(n.requestAnimationFrame=function(t){var r;return e=Math.max(e+16,r=+(new Date)),n.setTimeout(function(){return t(+(new Date))},e-r)}),n.cancelAnimationFrame||(n.cancelAnimationFrame=function(e){return clearTimeout(e)})})(),Game=function(){function e(e,t,n){this.board=e,this.events=t,this.options=n,this.play=__bind(this.play,this),this.handleBullet=__bind(this.handleBullet,this),this.handleTank=__bind(this.handleTank,this),this.createBullet=__bind(this.createBullet,this),this.createTank=__bind(this.createTank,this),this.objects={},this.options=$.extend({msPerRound:100},this.options)}return e.prototype.initialize=function(){return this.lastRound=window.mozAnimationStartTime||Date.now(),requestAnimationFrame(this.play)},e.prototype.createTank=function(e){var t,n;return t=$('<div class="tank"><div class="body"></div><div class="cannon"></div><div class="life"></div></div>'),n={tank:t,body:t.find(".body"),cannon:t.find(".cannon"),life:t.find(".life")},this.board.append(t),this.objects[e.id]=n,n},e.prototype.createBullet=function(e){var t,n;return t=$('<div class="bullet"><div class="explosion"></div></div>'),this.board.append(t),n={bullet:t,width:t.width(),height:t.height()},this.objects[e.id]=n,n},e.prototype.handleTank=function(e){var t;return t=this.objects[e.id]||this.createTank(e),t.tank.css("top",e.position.y-e.dimension.height/2),t.tank.css("left",e.position.x-e.dimension.width/2),t.body.css("transform","rotate("+e.angle+"deg)"),t.cannon.css("transform","rotate("+(e.angle+e.cannonAngle)+"deg)"),t.life.css("width",30*e.life/100)},e.prototype.handleBullet=function(e){var t;return t=this.objects[e.id]||this.createBullet(e),t.bullet.css("top",e.position.y-t.height/2),t.bullet.css("left",e.position.x-t.width/2),t.bullet.css("transform","rotate("+e.angle+"deg)")},e.prototype.play=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;r=e-this.lastRound,o=r/this.options.msPerRound,this.lastRound=window.mozAnimationStartTime||Date.now();for(s=u=0;0<=o?u<=o:u>=o;s=0<=o?++u:--u){if(this.events.length===0)break;i=this.events.shift(),h=i.objects;for(a=0,l=h.length;a<l;a++){n=h[a];switch(n.type){case"tank":this.handleTank(n);break;case"bullet":this.handleBullet(n)}}p=i.events;for(f=0,c=p.length;f<c;f++){t=p[f],n=this.objects[t.id];switch(t.type){case"moving":n&&n.tank.addClass("moving");break;case"backwards":n&&n.tank.addClass("backwards");break;case"stopped":n&&n.tank.removeClass("backwards").removeClass("moving");break;case"exploded":n&&n.bullet.addClass("exploding")}}}if(this.events.length>0)return requestAnimationFrame(this.play)},e}();